services:

  # ============================================================
  # FastAPI 백엔드
  # ============================================================
  backend:
    build: ./10_backend
    container_name: caf_backend
    environment:
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_PORT: ${DB_PORT}
      DB_NAME: ${DB_NAME}
      SECRET_KEY: ${SECRET_KEY}
      GMAIL_ADDRESS: ${GMAIL_ADDRESS}
      GMAIL_APP_PASSWORD: ${GMAIL_APP_PASSWORD}
      DEVELOPMENT_MODE: ${DEVELOPMENT_MODE}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID} # 구글 로그인 추가
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
    ports:
      - "8001:8000"
    volumes:
      - ./10_backend/app:/app/app # 핫 리로드용

  # ============================================================
  # 프론트엔드 (관리자)
  # ============================================================
  admin_front:
    build: ./21_frontend_admin
    container_name: caf_front_admin
    ports:
      - "3001:3000"
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8001/api
    depends_on:
      - backend

  # ============================================================
  # Nginx (리버스 프록시)
  # ============================================================
  nginx:
    build: ./30_nginx
    container_name: caf_nginx
    ports:
      - "80:80"
    volumes:
      - ./30_nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend

  # ============================================================
  # LLM 서비스
  # ============================================================
  llm_analysis:
    build: ./51_llm_analysis
    container_name: caf_llm_analysis
    ports:
      - "9102:9102"
    environment:
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      MAX_DAILY_CALLS: 100 # 일일 최대 API 호출 수
      MAX_RPM: 10 # 분당 최대 API 요청 수
