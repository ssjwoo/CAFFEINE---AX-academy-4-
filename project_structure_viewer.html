<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 구조 시각화</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .tab:hover, .tab.active {
            background: white;
            color: #667eea;
        }
        .diagram-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
        }
        .diagram-container.active {
            display: block;
        }
        .diagram-container h2 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .mermaid {
            text-align: center;
        }
        .footer {
            text-align: center;
            color: rgba(255,255,255,0.8);
            margin-top: 30px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Caffeine 프로젝트 구조 시각화</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab(0)">시스템 아키텍처</button>
            <button class="tab" onclick="showTab(1)">데이터 흐름</button>
            <button class="tab" onclick="showTab(2)">디렉토리 구조</button>
            <button class="tab" onclick="showTab(3)">백엔드 구조</button>
            <button class="tab" onclick="showTab(4)">프론트엔드 구조</button>
            <button class="tab" onclick="showTab(5)">Git 변경사항</button>
        </div>

        <!-- 시스템 아키텍처 -->
        <div class="diagram-container active" id="tab0">
            <h2>1. 전체 시스템 아키텍처</h2>
            <div class="mermaid">
graph TB
    subgraph Client["클라이언트"]
        A["20_frontend_user\nReact Native Expo"]
        B["21_frontend_admin\n관리자"]
    end
    
    subgraph Server["백엔드 서버"]
        C["10_backend\nFastAPI"]
        D["ML Router\nml.py"]
        E["Preprocessing\npreprocessing.py"]
    end
    
    subgraph ML["ML 모델"]
        F["Production Models\nLightGBM 25MB"]
    end
    
    subgraph Storage["데이터 저장"]
        G["AsyncStorage\n로컬 캐시"]
        H["CSV Files\n사용자 데이터"]
    end
    
    A -->|HTTP API| C
    B -->|HTTP API| C
    C -->|라우팅| D
    D -->|전처리| E
    D -->|모델 로드| F
    E -->|예측| F
    A -->|CSV 업로드| D
    A -->|캐시| G
    D -->|파일 처리| H
    
    style A fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    style C fill:#ffe1e1,stroke:#d32f2f,stroke-width:2px
    style D fill:#fff4e1,stroke:#ff9800,stroke-width:2px
    style F fill:#e1ffe1,stroke:#388e3c,stroke-width:2px
            </div>
        </div>

        <!-- 데이터 흐름 -->
        <div class="diagram-container" id="tab1">
            <h2>2. 데이터 흐름 (Sequence Diagram)</h2>
            <div class="mermaid">
sequenceDiagram
    participant User as 사용자
    participant TS as TransactionScreen
    participant TC as TransactionContext
    participant API as Backend API
    participant ML as ML Model
    participant DS as DashboardScreen
    
    User->>TS: CSV 파일 업로드
    TS->>API: POST /ml/upload
    API->>ML: 전처리 + 예측
    ML-->>API: 예측 결과
    API-->>TS: 거래 데이터 + AI 카테고리
    TS->>TC: saveTransactions()
    TC->>TC: AsyncStorage 저장
    
    Note over TC,DS: 자동 동기화
    
    TC->>API: POST /ml/predict-next
    API->>ML: 다음 소비 예측
    ML-->>API: 카테고리 + 신뢰도
    API-->>TC: 예측 결과
    TC->>DS: 상태 업데이트
    DS->>User: 대시보드 표시
            </div>
        </div>

        <!-- 디렉토리 구조 -->
        <div class="diagram-container" id="tab2">
            <h2>3. 디렉토리 구조 변화</h2>
            <div class="mermaid">
graph LR
    subgraph Before["정리 전 - 19개 파일"]
        A1["문서 7개\n루트에 산재"]
        A2["데이터 3개\n82MB 모델"]
        A3["frontend/\n중복 디렉토리"]
    end

    subgraph After["정리 후 - 7개 파일"]
        B1["00_docs_core/\n문서 체계화"]
        B2["archive/\n82MB 보관"]
        B3["production_models/\n25MB 모델"]
        B4["start_all.sh\nstop_all.sh"]
    end
    
    A1 -.이동.-> B1
    A2 -.이동.-> B2
    A3 -.삭제.-> X["Git 히스토리"]
    
    style A1 fill:#ffe1e1
    style A2 fill:#ffe1e1
    style A3 fill:#ffe1e1
    style B1 fill:#e1ffe1
    style B2 fill:#fff4e1
    style B3 fill:#e1f5ff
            </div>
        </div>

        <!-- 백엔드 구조 -->
        <div class="diagram-container" id="tab3">
            <h2>4. 백엔드 모듈 의존성</h2>
            <div class="mermaid">
graph TD
    A["main.py\nFastAPI App"]
    B["routers/ml.py\n407줄"]
    C["services/preprocessing.py\n433줄"]
    D["Production Models"]
    E["load_model()"]
    F["pandas, scikit-learn"]
    
    A -->|include_router| B
    A -->|startup_event| E
    B -->|import| C
    B -->|import| E
    E -->|load| D
    C -->|use| F
    B -->|predict| D
    
    style A fill:#e1f5ff,stroke:#0288d1
    style B fill:#ffe1e1,stroke:#d32f2f
    style C fill:#fff4e1,stroke:#ff9800
    style D fill:#e1ffe1,stroke:#388e3c
            </div>
            
            <h2 style="margin-top: 40px;">ML API 엔드포인트</h2>
            <div class="mermaid">
graph LR
    subgraph Endpoints["API 엔드포인트"]
        E1["POST /ml/predict\n단일 예측"]
        E2["POST /ml/upload\n일괄 예측"]
        E3["POST /ml/predict-next\n다음 소비 예측"]
    end
    
    subgraph Response["응답"]
        R1["prediction: 카테고리"]
        R2["transactions: 목록\nsummary: 통계"]
        R3["predicted_category: 외식\nconfidence: 0.85"]
    end
    
    E1 --> R1
    E2 --> R2
    E3 --> R3
    
    style E1 fill:#e1f5ff
    style E2 fill:#e1ffe1
    style E3 fill:#fff4e1
            </div>
        </div>

        <!-- 프론트엔드 구조 -->
        <div class="diagram-container" id="tab4">
            <h2>5. 프론트엔드 컴포넌트 관계</h2>
            <div class="mermaid">
graph TD
    A["App.js"]
    B["TransactionProvider"]
    C["DashboardScreen\n808줄"]
    D["TransactionScreen"]
    E["MLTestScreen\n175줄"]
    F["ProfileScreen"]
    G["ML API"]
    
    A -->|wrap| B
    B -->|context| C
    B -->|context| D
    B -->|context| E
    B -->|context| F
    
    C -->|useTransactions| B
    D -->|useTransactions| B
    E -->|useTransactions| B
    
    C -->|predictNextPurchase| G
    D -->|uploadCSV| G
    E -->|predict| G
    
    style A fill:#e1f5ff
    style B fill:#ffe1e1
    style C fill:#fff4e1
    style D fill:#e1ffe1
    style G fill:#ffe1ff
            </div>
            
            <h2 style="margin-top: 40px;">Context API 패턴</h2>
            <div class="mermaid">
graph TD
    subgraph Context["TransactionContext.js 175줄"]
        S1["transactions 상태"]
        S2["loading 상태"]
        S3["lastSyncTime 상태"]
    end
    
    subgraph Functions["제공 함수"]
        F1["saveTransactions()"]
        F2["updateTransactionNote()"]
        F3["clearTransactions()"]
        F4["predictNextPurchase()"]
    end
    
    Context --> Functions
    
    style S1 fill:#e1f5ff
    style F4 fill:#fff4e1
            </div>
        </div>

        <!-- Git 변경사항 -->
        <div class="diagram-container" id="tab5">
            <h2>6. Git 변경사항 분석</h2>
            <div class="mermaid">
graph TD
    A["Git 변경사항\n43개 파일"]
    
    A --> B["삭제 33개"]
    A --> C["추가 21개"]
    A --> D["수정 9개"]
    
    B --> B1["frontend/ 27개\n14,846줄"]
    B --> B2["문서 5개\n4,003줄"]
    B --> B3["app.json 1개"]
    
    C --> C1["00_docs_core/ 7개"]
    C --> C2["스크립트 4개"]
    C --> C3["백엔드 ML 4개\n840줄"]
    C --> C4["프론트엔드 ML 2개\n285줄"]
    
    D --> D1["백엔드 2개\nmain.py, requirements.txt"]
    D --> D2["프론트엔드 7개\nApp.js, screens/"]
    
    style B fill:#ffe1e1
    style C fill:#e1ffe1
    style D fill:#fff4e1
            </div>
            
            <h2 style="margin-top: 40px;">코드 라인 변경</h2>
            <div class="mermaid">
pie title 코드 라인 변경 분포
    "삭제 20,029줄" : 20029
    "추가 669줄" : 669
            </div>
        </div>

        <div class="footer">
            <p>Caffeine 프로젝트 구조 시각화 | 생성일: 2024-12-08</p>
            <p>Mermaid 다이어그램 6개 | 브라우저에서 직접 실행</p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });

        function showTab(index) {
            // 모든 탭 비활성화
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            
            // 모든 다이어그램 숨기기
            document.querySelectorAll('.diagram-container').forEach((container, i) => {
                container.classList.toggle('active', i === index);
            });
        }
    </script>
</body>
</html>
